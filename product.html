<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Products</title>

  <style>
    :root{
      --b:#1a73e8;--b2:#0b57d0;
      --line:#e0e0e0;--muted:#5f6368;
      --soft:#eaf2ff;
      --card:#ffffff;
      --shadow:0 14px 40px rgba(26,115,232,.12);
      --shadow2:0 10px 24px rgba(0,0,0,.06);
      --r:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui;color:#202124;
      background:linear-gradient(180deg,var(--soft),#fff 55%);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{
      background:#fff;border:1px solid #dbe7ff;border-radius:22px;
      box-shadow:var(--shadow);overflow:hidden
    }
    h2{
      margin:0;padding:14px 16px;border-bottom:1px solid #e8f0fe;
      display:flex;justify-content:space-between;align-items:center
    }
    .pill{
      background:#e8f0fe;border:1px solid #d2e3fc;
      padding:6px 10px;border-radius:999px;font-weight:900;font-size:12px
    }
    .content{padding:14px 16px}

    .row{
      display:grid;
      grid-template-columns:1.2fr .8fr .35fr;
      gap:10px
    }
    @media(max-width:860px){.row{grid-template-columns:1fr}}

    label{font-size:12px;color:var(--muted)}
    input,select{
      width:100%;padding:11px 12px;border-radius:14px;
      border:1px solid #dbe7ff;font-size:14px
    }
    button{
      border:none;border-radius:14px;padding:11px 14px;
      background:linear-gradient(135deg,var(--b),var(--b2));
      color:#fff;font-weight:900;cursor:pointer
    }

    /* grid */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:14px
    }
    @media(max-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:420px){.grid{grid-template-columns:1fr}}

    .p{
      border:1px solid #dbe7ff;border-radius:24px;
      box-shadow:var(--shadow2);
      background:#fff;display:flex;flex-direction:column;
      min-height:320px
    }
    .p__top{padding:10px;background:#f5f8ff}
    .p__imgWrap{
      aspect-ratio:1/1;border-radius:18px;
      border:1px solid #e8f0fe;
      display:flex;align-items:center;justify-content:center;
      background:#fff;overflow:hidden
    }
    .p__imgWrap img{width:100%;height:100%;object-fit:contain}
    .badge{
      font-size:12px;font-weight:900;
      background:#e8f0fe;color:#0b57d0;
      border:1px solid #d2e3fc;
      padding:6px 10px;border-radius:999px;
      display:inline-block;margin-bottom:6px
    }
    .badge--sale{
      background:#fff0f0;color:#b42318;border-color:#ffd2d2
    }
    .p__body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .p__name{font-weight:900;line-height:1.3}
    .tag{
      background:#f5f8ff;border:1px solid #e8f0fe;
      padding:4px 8px;border-radius:999px;
      font-size:12px;font-weight:800
    }
    .price{font-size:18px;font-weight:1000;color:#0b57d0}
    .tiny{font-size:12px;color:#5f6368}
    .p__bottom{
      margin-top:auto;padding:10px 12px;
      display:flex;justify-content:space-between;
      border-top:1px solid #eef4ff
    }
    .stock,.code{
      font-size:12px;font-weight:900;
      padding:6px 10px;border-radius:999px
    }
    .stock{background:#ecfdf3;border:1px solid #abefc6}
    .code{background:#f3f4f6;border:1px solid #e5e7eb}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h2>
      <span>Danh sách sản phẩm</span>
      <span class="pill" id="count">0</span>
    </h2>

    <div class="content">
      <div class="row">
        <div>
          <label>Tìm kiếm</label>
          <input id="search" placeholder="Tên, mã, OEM...">
        </div>
        <div>
          <label>Nhóm hàng</label>
          <select id="category">
            <option value="">Tất cả</option>
          </select>
        </div>
        <div style="display:flex;align-items:end">
          <button id="btn">Tải</button>
        </div>
      </div>

      <div id="grid" class="grid">
        <div class="tiny">Chưa có dữ liệu</div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== MOCK JSONP (khi gắn GAS thì bỏ mock này) ===== */
async function jsonp(action, params={}){
  if(action!=='products') return {categories:[]};

  return {
    rows:[
      {
        "Tags Products":"Lọc dầu Toyota",
        "Category":"Động cơ",
        "Sale Price":120000,
        "Cost Price":80000,
        "Stock":15,
        "SKU":"TOY-OF-01",
        "Images":"https://i.imgur.com/6XH9K0N.png"
      }
    ]
  }
}
/* =================================================== */

const $ = id=>document.getElementById(id);

const money=v=>{
  const n=Number(v);
  return isFinite(n)?new Intl.NumberFormat('vi-VN').format(n)+'đ':'';
};

function norm(o){
  const x={};
  for(const k in o) x[k.trim().toLowerCase()]=o[k];
  return x;
}
const pick=(o,...k)=>k.map(x=>o[x]).find(v=>v!==undefined&&v!=='' )||'';

function firstImage(v){
  if(Array.isArray(v)) return v[0]||'';
  if(typeof v==='string') return v.split(/[,\s]+/)[0]||'';
  return '';
}

function render(rows){
  const grid=$('grid');
  grid.innerHTML='';
  if(!rows.length){
    grid.innerHTML='<div class="tiny">Chưa có dữ liệu</div>';return;
  }

  rows.forEach(r=>{
    const p=norm(r);

    const name=pick(p,'tags products','product','products','name');
    const cat =pick(p,'category');
    const sale=money(pick(p,'sale price','price'));
    const cost=money(pick(p,'cost price','cost'));
    const stock=pick(p,'stock');
    const code =pick(p,'sku','code');
    const img =firstImage(pick(p,'images','image'));

    grid.insertAdjacentHTML('beforeend',`
      <div class="p">
        <div class="p__top">
          ${cat?`<div class="badge">${cat}</div>`:''}
          <div class="p__imgWrap">
            ${img?`<img src="${img}">`:`<div class="tiny">No image</div>`}
          </div>
        </div>
        <div class="p__body">
          <div class="p__name">${name}</div>
          <div class="price">${sale||'—'}</div>
          <div class="tiny">${cost?`Nhập: ${cost}`:''}</div>
        </div>
        <div class="p__bottom">
          <div class="stock">Tồn: ${stock||'—'}</div>
          <div class="code">${code||'NO-CODE'}</div>
        </div>
      </div>
    `);
  });

  $('count').textContent=rows.length+' SP';
}

async function load(){
  const res=await jsonp('products');
  console.log(res.rows[0]);
  render(res.rows||[]);
}

$('btn').onclick=load;
load();
</script>
</body>
</html>
